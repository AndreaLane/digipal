{% extends "base.html" %}
{% load mezzanine_tags pagination_tags html_escape %}

{% block meta_title %}Manuscript Images{% endblock %}


{% block main %}
    <h1 class='header1'>Manuscript Images</h1>

    <form id='searchform' class="form-inline panel" action='.'>
        <div class="row-fluid">
            <div class="span1">
                Filter by
            </div>
            <div class="span8">
                <ul class="flat-list">
                    {{ filterImages.as_ul }}
                </ul>
            </div>
            <div class="span3">
                <input type='submit' value='Filter Images' class='btn btn-primary'>
            </div>
        </div>
        <div class="row-fluid">
        </div>
    </form>

    {% if request.GET.town_or_city or request.GET.repository or request.GET.date %}
        <div class='breadcrumb'>
          {% comment %} <span>You are searching for: </span><span><b>Term</b>: {{terms}}</span> |{% endcomment %}
          {% if request.GET.town_or_city %} <span><b>Town or City: </b></span><span> {{ request.GET.town_or_city }}</span>{% endif %}
          {% if request.GET.repository %}| <span><b>Repository: </b></span><span>{{ request.GET.repository }}</span>{% endif %}
          {% if request.GET.date %}| <span><b>Date: </b></span><span>{{ request.GET.date }}</span>{% endif %}
        </div>
    {% endif %}

    <div class='row-fluid'>
        {# {% include "digipal/image_list_pagination.html" %} #}
        <div class="span8">
            {% autopaginate images 12 as images_on_this_page %}
            {% paginate %}
        </div>

        <div class='span2 pull-right' id='view-switch'>
            <ul class="nav nav-pills">
                <li class="{% if view == 'images' %}active{% endif %}">
                    <a data-target="#images" data-toggle="pill" title='Change Manuscripts View to Images' href="{% filter add_query_params:request.META.QUERY_STRING %}?view=images{% endfilter %}">Images</a>
                </li>

                <li class="{% if view == 'list' %}active{% endif %}">
                    <a data-target="#list" data-toggle="pill" title='Change Manuscripts View to List' href="{% filter add_query_params:request.META.QUERY_STRING %}?view=list{% endfilter %}">List</a>
                </li>
            </ul>
        </div>

    </div>

    {% if images_on_this_page %}


        <div class='container'>
            <div class="tab-content">

                <div class="tab-pane fade {% if view == 'Images' %}active in{% endif %}" id="images">

                    {% for image in images_on_this_page %}
                        {% if forloop.counter0|divisibleby:4 %}
                            <div class="row-fluid">
                        {% endif %}
                                <div class='span3 panel centered' >
                                    <p class='imageDetails'>
                                        <a {% ifequal image.annotation_set.all.count 0 %} class='disabled' href='#' {% else %} href='{{ image.id }}/' {% endifequal %} style='font-weight:bold;' data-toggle="tooltip" title="View Image Annotations" >View Annotations</a>
                                        |
                                        <a data-toggle="tooltip" style='font-weight:bold;' title="View Image only" href="{{ image.id }}/?annotations=false">View Image</a></p>
                                    <dl class="imageDatabase">
                                        <dt>
                                            <a data-id='{{ image.id }}' class='droppable_image' href="{{ image.id }}/">
                                                <span class="drag_caption">Drag Image to basket</span>
                                                {% iip_img image width=200 lazy=1 %}
                                            </a>
                                        </dt>
                                        <dd>
                                            <a style='font-weight:bold' href="{{ image.id }}/">{{ image }}</a>
                                        </dd>
                                    </dl>
                                    <p style='line-height:1'>
                                        <span class="label label-important">
                                            {{ image.annotation_set.all.count }}
                                            {% if image.annotation_set.all.count == 1 %} Annotation {% else %} Annotations {% endif %}
                                        </span>
                                        <span class="label label-important">
                                            {{ image.hands.all.count }}
                                            {% if image.hands.all.count == 1 %} Hand {% else %} Hands {% endif %}
                                        </span>
                                    </p>
                                </div>
                        {% if forloop.counter|divisibleby:4 or forloop.last %}

        <div class="tab-content">

            <div class="tab-pane fade {% if view == 'images' %}active in{% endif %}" id="images">

                {% for image in images_on_this_page %}
                    {% if forloop.counter0|divisibleby:4 %}
                        <div class="row-fluid">
                    {% endif %}
                            <div class='span3 panel centered' >
                                <p class='imageDetails'>
                                    <a data-toggle="tooltip" title="View Image Annotations" class='btn btn-link {% if not image.annotation_set.all.count %}disabled{% endif %}' href='{{ image.id }}/'>View Annotations</a>
                                    <a data-toggle="tooltip" style='font-weight:bold;' title="View Image only" href="{{ image.id }}/?annotations=false">View Image</a>
                                </p>
                                <dl class="imageDatabase">
                                    <dt>
                                        <a data-id='{{ image.id }}' class='droppable_image' href="{{ image.id }}/">
                                            <span class="drag_caption">Drag Image to basket</span>
                                            {% iip_img image width=200 lazy=1 %}
                                        </a>
                                    </dt>
                                    <dd>
                                        <strong><a href="{{ image.id }}/">{{ image }}</a></strong>
                                    </dd>
                                </dl>
                                <p>
                                    <span class="label label-important">{{ image.annotation_set.all.count }} Annotations</span>
                                    <span class="label label-success">{{ image.hands.all.count }} Hands</span>
                                </p>
                            </div>
                    {% if forloop.counter|divisibleby:4 or forloop.last %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>

            <div class="tab-pane fade {% if view == 'list' %}active in{% endif %}" id="list">

                <table class='table table-condensed'>
                    <tbody>
                        <tr>
                            <th>&nbsp;</th>
                            <th>Page</th>
                            <th>Place</th>
                            <th>Repository</th>
                            <th>Annotations</th>
                            <th>Hands</th>
                        </tr>
                        {% for image in images_on_this_page %}
                            <tr>
                                <td><a class='view_button' href='{{ image.id }}/'>View</a></td>
                                <td><a data-id='{{ image.id }}' class='droppable_image' href='{{ image.id }}/'>{{image}}</a></td>
                                <td>{{image.item_part.current_item.repository.place}}</td>
                                <td>{{image.item_part.current_item.repository.name}}</td>
                                <td>{{ image.annotation_set.all.count }}</td>
                                <td>{{ image.hands.all.count }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

            </div>

        </div>

    {% else %}
        <div class='alert alert-warning'>
            <h6>No Images available</h6>
        </div>
    {% endif %}

    <div class="row-fluid">
        {% paginate %}
    </div>

    <div id='basket_collector'>
        <p>Add Image to Basket</p>
        <p>
            <img src='/static/digipal/images/shopping-cart-icon.png' alt="add to collection" />
        </p>
    </div>

{% endblock %}

{% block extra_js %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/chosen.jquery.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}digipal/scripts/add_to_lightbox.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}digipal/scripts/drag_to_lightbox.js"></script>
{% endblock %}
