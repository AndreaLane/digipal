{% extends "base.html" %}
{% load pages_tags mezzanine_tags i18n %}
{% load mezzanine_tags pagination_tags html_escape %}
{% block extra_js %}
<script type="text/javascript" src="https://raw.github.com/harvesthq/chosen/master/chosen/chosen.jquery.js"></script>
{% endblock %}
{% block main %}
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css"></style>
<form id='searchform' class="form-inline panel" method="GET" action=".">
    <div class='row-fluid'>
    {# {% csrf_token %} #}
      <div class='span9'>
            <div id='radio'>
                <h3 class='header5'>Search</h3>
                {{ searchform }}
                 <script>
                    $('#radio ul').contents().unwrap();
                    $('#radio li').contents().unwrap();
                    // Then move the input to outside of the label
                    $('#radio > label > input').each(function() {
                        $(this).parent().before(this);
                    });
                    // Then apply the jQuery UI buttonset
                    $("#radio").buttonset();
                    $('#radio .ui-button-text').css('padding','.2em 1em');
                </script>  
                     
            </div>
        </div>
    </div>
         <script>
            $(document).ready(function() {
                var radio = $("#searchform input[type='radio']");

                // Setting default radio
                var container = $('#containerFilters');
                var content = $('{{ filterScribes.as_ul|escapejs }}');
                container.html(content);

                // Setting default label
                var labelFilters = $('#labelFilters');
                var label = "<h5 class='header5'>Show Scribes filtered by:</h5>";
                labelFilters.html(label);

                // event onchange on radios
                radio.change(function(){
                    content = '';
                    label = '';                       
                    if($("#searchform input[type='radio']:checked").val() == 'hands'){
                            content += '{{ filterHands.as_ul|escapejs }}';
                            label += "<h5 class='header5'>Show Hands filtered by:</h5>";
                        } else if($("#searchform input[type='radio']:checked").val() == 'manuscripts') {
                            content += '{{filterManuscripts.as_ul|escapejs}}';
                            label += "<h5 class='header5'><b>Show Manuscripts filtered by:</h5>";
                        } else {
                            content += '{{filterScribes.as_ul|escapejs}}';
                            label += "<h5 class='header5'>Show Scribes filtered by:</h5>";
                        }
                    labelFilters.html(label);
                    container.html(content);
                    $('select').chosen();
                    $('select').change(function(){
                    result = false; 
                    for(i = 0; i < $(this).length; i++){
                        if(($(this)[i].value != '')){
                            result = true;
                        }
                    }
                    if(!result){
                        $('#textEntry').attr('required', 'required');
                    } else {
                        $('#textEntry').attr('required', false);
                    }
                });
               });

                advancedSearch = 0;
                    $('#advanced').click(function(){
                    if(advancedSearch == 0){
                        $('#advancedSearch').slideDown();
                        $('#advanced').text('Hide Advanced Search');
                        advancedSearch = 1;
                    } else {
                        $('#advancedSearch').slideUp();
                        $('#advanced').text('Advanced Search');
                        advancedSearch = 0;
                    }
                    $('select').chosen();
                });


                $('#filtersform').hide();
                var filter = 0;
                options = {
                  'title': 'Show Graph Filters',
                  'content': 'Click this button to explore and filter graphs',
                  'trigger': 'hover'
                }
                $('#show_filters').popover(options)
                $('#show_filters').click(function(){
                  if(filter == 0){
                    $('#filtersform').slideDown();
                    $('#show_filters').attr('class', 'btn');
                    $('#show_filters').text('Hide Graphs Filters');
                    filter = 1;
                  } else {
                    $('#filtersform').slideUp();
                    $('#show_filters').attr('class', 'btn btn-success');
                    $('#show_filters').text('Show Graphs Filters');
                    filter = 0;
                  }
                  $('select').chosen();

                });

                $('select').change(function(){
                    result = false; 
                    for(i = 0; i < $(this).length; i++){
                        if(($(this)[i].value != '')){
                            result = true;
                        }
                    }
                    if(!result){
                        $('#textEntry').attr('required', 'required');
                    } else {
                        $('#textEntry').attr('required', false);
                    }
                });




            tags = {{ suggestions|safe }}
                    $("#textEntry").typeahead({
                        source:tags,
                        items: 8,
                        minLength: 0
                    })

                    
            });
        </script>
        <div class='container'>
            <a id='advanced' class='btn btn-link' style='margin-left:0;padding-left:0;'>Advanced Search</a>
                <div id='advancedSearch'>
                    <div id='labelFilters'></div>
                    <div id='containerFilters' class='form-inline'></div>
                </div>
        </div>
        <div class='container' id='buttonsBox'>
          <input type="submit" value="Search" class='btn btn-primary' />
         <a class='btn btn-success' id='show_filters'>Show Graphs Filters</a>
        </div>
    </form>
    <div class="panel" id='filtersform'>
      <h5 class='header5'>Show Graphs filtered by:</h5>
      <form class="container form-inline"  method="GET" action="/digipal/search/graph">
      {{ drilldownform }}
      <div class='container'>
            <input type="submit" value="Show Graphs" class='btn btn-primary' />
            <input type='reset' class='btn' />
        </div>
    </form>
    </div>

</div>
    <div class='breadcrumb'>
      <span>You are searching for: </span><span><b>Term</b>: {{terms}}</span>
      {% if request.GET.name %}| <span><b>Name: </b></span><span> {{ request.GET.name }}</span>{% endif %}
      {% if request.GET.scriptorium %}| <span><b>Scriptorium: </b></span><span>{{ request.GET.scriptorium }}</span>{% endif %}
      {% if request.GET.date %}| <span><b>Date: </b></span><span>{{ request.GET.date }}</span>{% endif %}
    </div> 
    <h2 class='header1'>Results for <i>Scribes</i></h2>
    <table class="table table-condensed">
        <tr>
            <th>Name</th>
            <th>Date</th>
            <th>Scriptorium</th>
            <th>Actions</th>
        </tr>

    {% autopaginate results 9 %}
    {% for result in results %}
    <tr>
        <td>{{ result.name }} {% if result.pages.all %}
            <a class='imageIcon' href='?terms={{ terms|spacify }}&amp;basic_search_type={{ type }}&amp;id={{ result.id }}&amp;record={{ forloop.counter }}&from_image=true' title='{{page}}'><img src="{{ STATIC_URL }}digipal/images/manuscript.jpg" alt='manuscript' title='This record contains {{result.pages.count}} images' /></a> ({{result.pages.count}}){% endif %}</td>
        <td>{{ result.date }}</td>
        <td>{{ result.scriptorium.name }}</td>
        <td>
                {% if request.user.is_superuser %}
                <a class="btn" href="/admin/digipal/scribe/{{ result.id }}">Edit</a>
                {% endif %}
                <a class="btn btn-primary" href="?terms={{ terms|spacify }}&amp;basic_search_type={{ type }}&amp;id={{ result.id }}&amp;record={{ forloop.counter }}">View</a>
        </td>
    </tr>
    {% endfor %}
    {% paginate %}
    </table>
<script>
$('select').chosen();
</script>
{% endblock main %}