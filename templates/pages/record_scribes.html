{% extends "pages/record.html" %}
{% load pages_tags mezzanine_tags i18n %}
{% load mezzanine_tags pagination_tags %}
{% load html_escape %}

{% block meta_title %}Scribe: {{ scribe.name }}{% endblock %}
{% block record_title %}
    Scribe: {{ scribe.name }}
    {% include "digipal/admin_edit.html" with instance=scribe %}
    {% if can_edit %}
    <a class='admin-edit' href='/digipal/admin/newscriptentry?scribe={{scribe.id}}'>[Edit Ideographs]</a>
    {% endif %}
{% endblock %}

{% block record_tabs %}
    <li class="active"><a href="{{ scribe.get_absolute_url }}" data-target="#data" data-toggle="tab">Information</a></li>
    <li class="{% if scribe.hands.all.count > 0 %}{% else %}disabled{% endif %}"><a href="{{ scribe.get_absolute_url }}hands/" data-target="#hands" data-toggle="tab">Hands ({{ scribe.hands.all.count }})</a></li>
    <li><a href="{{ scribe.get_absolute_url }}pages/" data-target="#pages" data-toggle="tab">Pages</a></li>
    <li class="{% if idiograph_components.distinct.count > 0 %}{% else %}disabled{% endif %}"><a href="{{ scribe.get_absolute_url }}idiographs/" data-target="#idiographs" data-toggle="tab">Idiographs ({{ idiograph_components.distinct.count }}) </a></li>
{% endblock %}

{% block details %}
    <div class='tabbable'>

        <div id='record-tab-content' class='tab-content'>
            <div class='tab-pane fade active in' id='data'>
                <h3>Date and Place</h3>

                <table class="table table-condensed">
                    <tbody>
                        <tr>
                            <th>Date</th>
                            <td>{{ scribe.date }}</td>
                        </tr>
                        <tr>
                            <th>Scriptorium</th>
                            <td>{{ scribe.scriptorium }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class='tab-pane fade' id='hands'>
                <div class='row-fluid'>
                    <table class="table table-condensed">
                        <tr>
                            <th>Item Part</th>
                            <th>Hand</th>
                        </tr>
                        {% for hand in scribe.hands.all %}
                            {% if hand %}
                                <tr>
                                    <td><a href="{{ hand.item_part.get_absolute_url }}">{{hand.item_part}}</a></td>
                                    <td><a href="{{ hand.get_absolute_url }}">{{hand}}</a></td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td><div class="alert alert-block"><h4>No hands available</h4></div></td>
                                </tr>
                            {% endif %}
                        {% endfor %}

                    </table>
                </div>
            </div>
            <script>
                var i = 0;
            </script>
            <div class='tab-pane fade' id='pages'>
                <table class='table table-condensed'>
                    <tr>
                        <th>Page</th>
                        <th>Hand</td>
                        <th>Image</th>
                    </tr>
                    {% for hand in scribe.hands.all %}
                        {% for image in hand.images.all %}
                        <script>
                            i++;
                        </script>
                            <tr>
                                <td>
                                    <a href="{{ image.get_absolute_url }}">{{ image }}</a>
                                </td>
                                <td>
                                    <a href="{{ hand.get_absolute_url }}">{{ hand }}</a>
                                </td>
                                <td style='padding:1%'>
                                    <a href="{{ image.get_absolute_url }}">
                                        {% iip_img image.iipimage height=100 %}
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    {% endfor %}
                    <script>
                            var pages_tab = document.querySelector("a[data-target='#pages']");
                            pages_tab.innerHTML = 'Pages (' + i + ')';
                            if(!i){
                                pages_tab.className += ' disabled';
                                var pages_element = document.querySelector('#pages');
                                pages.innerHTML = '<div class="alert alert-block"><h6>No Pages available</h6></div>';
                            }
                    </script>
                </table>
            </div>

            <div class='tab-pane fade' id='idiographs'>
                <div id='idiographsView'>

                {% if idiograph_components %}
                    {% for idiograph in idiograph_components.all %}
                    <div class="idiograph_scribe">
                        <h4><b>Idiograph:</b> {{idiograph}}</h4>
                        {% if can_edit %}
                        {% endif %}
                        {% for component in idiograph.idiographcomponent_set.all %}
                            <p class='component_scribe'>{{ component.component }}</p>
                            {% for feature in component.features.all %}
                                <p class='feature_scribe'>{{feature}}</p>
                            {% endfor %}
                        {% endfor %}
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-block">
                        <h6>No Idiographs available</h6>
                    </div>
                {% endif %}
                </div>
            </div>

        </div>
    </div>
{% endblock %}
