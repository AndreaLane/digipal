{% extends "pages/record.html" %}
{% load pages_tags mezzanine_tags i18n %}
{% load mezzanine_tags pagination_tags %}

{% block meta_title %}Manuscript: {{ item_part.display_label }}{% endblock %}
{% block record_title %}
    Manuscript: {{ item_part.display_label }}
    {% include "digipal/admin_edit.html" with instance=item_part %}
{% endblock %}

{% block record_tabs %}
    <li class="active"><a href="{{ item_part.get_absolute_url }}" data-target="#data" data-toggle="tab">Record Data</a></li>
    <li><a href="{{ item_part.get_absolute_url }}descriptions/"  data-target="#descriptions" data-toggle="tab">Descriptions</a></li>
    <li><a href="{{ item_part.get_absolute_url }}pages/" data-target="#pages" data-toggle="tab">Pages ({{ images.count }})</a></li>
    <li><a href="{{ item_part.get_absolute_url }}hands/" data-target="#hands" data-toggle="tab">Hands ({{ hands.count }})</a></li>
{% endblock %}

{% block details %}
    <div class='tabbable'>
        <div id='myTabContent' class='tab-content'>
            <div class='tab-pane fade active in' id='data'>
                <h3>Location</h3>
                <table class="table table-condensed">
                    <tbody>
                        <tr>
                            <th>Repository</th>
                            <td>{{ item_part.current_item.repository.name }}</td>
                        </tr>
                        <tr>
                            <th>Town or City</th>
                            <td>{{ item_part.current_item.repository.place }}</td>
                        </tr>
                        <tr>
                            <th>Shelfmark</th>
                            <td>
                                {{ item_part.current_item.shelfmark }}
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h3>Data</h3>
                <table class="table table-condensed">
                    <tbody>
                        <tr>
                            {% comment %}TODO: use item_part.historical_itemS {% endcomment %}
                            <th>Date</th>
                            <td>{{ item_part.historical_item.date }}</td>
                        </tr>
                        <tr>
                            <th>Origin</th>
                            <td>
                                {% for data in item_part.historical_item.itemorigin_set.all %}
                                    <b>Evidence</b>: {{ data.evidence }}
                                    {% if data.dubitable %}, <b>Dubitable</b>{% endif %}
                                {% endfor %}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class='tab-pane fade' id='descriptions'>
                <table class="table table-condensed">
                    <tbody>
                        <tr>
                            <th>MS Name</th>
                            <td>{{ item_part.historical_item.name }} </td>
                        </tr>
                        <tr>
                            <th>Index</th>
                            <td>{{ item_part.historical_item.catalogue_number }}</td>
                        </tr>
                        <tr>
                            <th>MS Description</th>
                            <td>
                                {% for historical_item in item_part.historical_items.all %}
                                    {% for desc in historical_item.description_set.all %}
                                        <p>
                                            {{ desc.description }}
                                            <br/>
                                            {{ desc.source.get_display_reference }}
                                        </p>
                                    {% endfor %}
                                {% endfor %}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            {% include "pages/tab_images.html" %}

            <div class='tab-pane fade' id='hands'>
                <div class='row-fluid'>
                    {% if hands.count %}
                        <table class='table table-condensed'>
                            <tbody>
                                <tr><th>Hands</th></tr>
                                {% for hand in hands %}
                                    <tr><td>{{ hand }}</td><tr>
                                {% endfor %}
                            <tbody>
                        </table>
                    {% else %}
                        <div class="alert alert-block">
                            <h4>No hands available</h4>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div id='basket_collector'>
        <p>Add Image to Basket</p>
        <p>
            <img src='/static/images/shopping-cart-icon.png' />
        </p>
    </div>
    
    {% block extra_js %}
    
    {{ block.super }}
    <script type="text/javascript" src="{{ STATIC_URL }}digipal/scripts/add_to_lightbox.js"></script>

    <script>
    $(document).ready(function(){
        var basket_collector = $('#basket_collector');
        basket_collector.droppable({
            accept: "a.droppable_image",
            hoverClass: "ui-state-active",
            drop: function(event, ui){

                var element = $(ui.helper[0]);


                if(add_to_lightbox(element, 'image', element.data('id'), false)){
                    var s = '<p>Image added to Lightbox!</p>';
                    s += '<p><img src="/static/digipal/images/success-icon.png" /></p>';
                    $(this).html(s);
                }

                setTimeout(function(){

                    s = '<p>Add image to Basket</p>';
                    s += '<p><img src="/static/digipal/images/shopping-cart-icon.png" /></p>';
                    basket_collector.html(s);

                    basket_collector.animate({
                        left: '100%'
                    }, 350);

                }, 3000);

            },
            out: function(){
                $(this).css('background', 'rgba(0, 0, 0, 0.5)');
            },
            over:function(){
                $(this).css('background', 'rgba(100, 100, 100, 0.5)');
            }
        });

        var images = $('a.droppable_image');
        images.draggable({
            containment: 'window',
            revert: true,
            stack: 'div',
            scroll: true,
            zIndex: 6000,
            start: function(){
                $('#basket_collector').animate({
                    left: '85%'
                }, 350);
            },
            stop: function(){
                $('#basket_collector').animate({
                    left: '100%'
                }, 350);
            }
        });
    });
    </script>
    {% endblock %}

{% endblock %}
