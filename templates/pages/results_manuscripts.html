{% extends "base.html" %}
{% load pages_tags mezzanine_tags i18n %}
{% load mezzanine_tags pagination_tags %}
{% block main %}
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css"></style>
<form id='searchform' class="form-inline panel" method="GET" action=".">
    <div class='row-fluid'>

            {# {% csrf_token %} #}
        <div class='span9'>
            <div id='radio'>
                <h3 class='header5'>Search</h3> {{ searchform }}
                <script>
                    $('#radio ul').contents().unwrap();
                    $('#radio li').contents().unwrap();
                    // Then move the input to outside of the label
                    $('#radio > label > input').each(function() {
                        $(this).parent().before(this);
                    });
                    // Then apply the jQuery UI buttonset
                    $("#radio").buttonset();
                    $('#radio .ui-button-text').css('padding','.2em 1em');
                </script>   
            </div>           
        </div>
    </div>
                 <script>
                    $(document).ready(function() {
                        var radio = $("#searchform input[type='radio']");

                        // Setting default radio
                        var container = $('#containerFilters');
                        var content = $('{{ filterManuscripts.as_ul|escapejs }}');
                        container.html(content);

                        // Setting default label
                        var labelFilters = $('#labelFilters');
                        var label = "<h5 class='header5'>Show Manuscripts filtered by:</h5>";
                        labelFilters.html(label);

                        // event onchange on radios
                        radio.change(function(){
                            content = '';
                            label = '';                       
                            if($("#searchform input[type='radio']:checked").val() == 'hands'){
                                content += '{{ filterHands.as_ul|escapejs }}';
                                label += "<h5 class='header5'>Show Hands filtered by:</h5>";
                            } else if($("#searchform input[type='radio']:checked").val() == 'manuscripts') {
                                content += '{{filterManuscripts.as_ul|escapejs}}';
                                label += "<h5 class='header5'><b>Show Manuscripts filtered by:</h5>";
                            } else {
                                content += '{{filterScribes.as_ul|escapejs}}';
                                label += "<h5 class='header5'>Show Scribes filtered by:</h5>";
                            }
                            labelFilters.html(label);
                            container.html(content);
                       });
                    });
                </script>
             <div class='container'>
                    <div id='labelFilters'></div>
                    <div id='containerFilters'></div>
            </div>             
            <div class='container'>
                <input type="submit" value="Search" class='btn btn-primary' />
                <input type='reset' class='btn' />
            </div>

        </form>
    <form class="form-inline panel" id='filtersform' method="GET" action="/graph">
      <h5 class='header5'>Show Graphs filtered by:</h5>
      <div class='container'>
      {{ drilldownform.as_ul }}
    </div>
      <div class='container'>
            <input type="submit" value="Show Graphs" class='btn btn-primary' />
            <input type='reset' class='btn' />
        </div>
    </form> 
    <h2 class='header1'>Results for <i>Manuscripts</i></h2>
    <table class="table table-condensed">
        <tr>
            <th>Index</th>
            <th>Repository</th>
            <th>Shelfmark</th>
            <th>Folio(s)</th>
            <th>Description</th>
            <th>Actions</th>
        </tr>
        {% autopaginate results 9 %}
        {% for result in results %}
        <tr class="{% cycle 'bgColour' '' %}">
            <td>{{ result.historical_item.catalogue_number }}</td>
            <td>{{ result.current_item.repository.name }}</td>
            <td>{{ result.current_item.shelfmark }}</td>
            <td>{{ result.locus }}</td>
            <td>
                {% for desc in result.historical_item.description_set.all %}
                {{ desc.description|truncatewords:15 }} ..
                {% endfor %}
            </td>
            <td>
                <ul class="nav nav-tabs">
                    {% if request.user.is_superuser %}
                    <li><a class="ctrl edit" href="/admin/digipal/itempart/{{ result.id }}">Edit</a></li>
                    {% endif %}
                    <li><a class="ctrl view" href="?terms={{ terms }}&amp;basic_search_type={{ type }}&amp;id={{ result.id }}&amp;amp;record={{ forloop.counter }}">View</a></li>
                </ul>
            </td>
        </tr>
        {% endfor %}
        {% paginate %}
    </table>
{% endblock main %}