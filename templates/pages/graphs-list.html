{% extends "base.html" %}
{% load pages_tags mezzanine_tags i18n %}
{% load mezzanine_tags pagination_tags %}
{% block extra_js %}
<script type="text/javascript" src="{{ STATIC_URL }}js/chosen.jquery.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/query_sorter.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/forms.reset.js"></script>
{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ STATIC_URL }}css/jquery-ui.css">
{% endblock %}
{% block main %}
<div class="row-fluid">

       {% ifnotequal style "allograph_list" %}
            {% with r=results|first %}
            <h1 class='header1'>{{ r.hand.assigned_place }}, {{ r.hand.item_part.current_item.repository.name }}, {{ r.hand.item_part.current_item.shelfmark }}</h1>
            {% endwith %}
            {% else %}
            <h1 class='header1'>Results for <i>Graphs</i></h1>
       {% endifnotequal %}
       
{% ifequal style "allograph_list" %} <!-- Display list view, of course -->
        <div class="panel" id='filtersform' style='display:block;'>
                <h5 class='header5'>Filter Graphs Attributes:</h5>
                <form></form>
                <form id='filterGraphs' class='container form-inline'  method="GET" action="/digipal/search/graph">
                    <ul id="drilldownformID">{{ drilldownform.as_ul }}</ul>
                    <div class='container'>
                        <input type="submit" value="Show Graphs" class='btn btn-primary' />
                        <input type='reset' class='btn' id="reset"/>
                    </div>
                </form> 
        </div>
        <div class='breadcrumb'style="margin-top:0;margin-bottom:5px;">
          {% if request.GET.script_select %}| <span><b>Script: </b></span><span> {{ request.GET.script_select }}</span>{% endif %}
          {% if request.GET.character_select %}| <span><b>Character: </b></span><span> {{ request.GET.character_select }}</span>{% endif %}
          {% if request.GET.component_select %}| <span><b>Component: </b></span><span>{{ request.GET.component_select }}</span>{% endif %}
          {% if request.GET.feature_select %}| <span><b>Feature: </b></span><span>{{ request.GET.feature_select }}</b></span>{% endif %}
          {% if request.GET.allograph_select %}| <span><b>Allograph: </b></span><span>{{ request.GET.allograph_select }}</span>{% endif %}
        </div>

    <div class='container'>
    {% if page_list.paginator.count > 24 %}
    {% load i18n %}
    
    <!--SCARTO 1 -->
    
    {% endif %}
    <div class='span2 pull-right' id='myTab'>
        <ul class="nav nav-pills">
            {% if view == 'Images' %}
            <li class="active">
             {% else %}
            <li>
             {% endif %}
              <a data-toggle="tooltip" title='Change Graphs View to Images' href="#images">Images</a>
             </li>
              {% if view == 'List' %}
             <li class="active">
            {% else %}
             <li>
             {% endif %}
            <a data-toggle="tooltip" title='Change Graphs View to List' href="#list">List</a>
            </li>
        </ul>
    </div>
</div>

   {% if page_list %}
    <div class='container'>
        <div class="tab-content">
            {% if view == 'Images' %}
                <div class="tab-pane fade active in" id="images">
            {% else %}
                <div class="tab-pane fade" id="images">
            {% endif %}
                <div id="centering">
            {% regroup graphs by hand as handlist %}
            
            {% autopaginate handlist 18 %}

            {% for hand in handlist %}

                {% if forloop.counter|divisibleby:6 %}

                <div class='row-fluid'>
                    <div class='span2 panel image' style='margin-left:0;padding-left:0;padding-top:0;margin-top:0;margin-bottom:0;padding-bottom:0;'>
                        <dl class="imageDatabase">
                            <dt>
                                {% for graph in hand.list %}
                                {% if forloop.counter < 10 %}
                                <a title={{ hand.grouper.id }} href="/digipal/page/{{ graph.annotation.page.id }}/?vector_id={{ graph.annotation.vector_id }}">{{ graph.annotation.thumbnail }}</a>
                                {% endif %}
                                {% endfor %}   
                            </dt>
                            <dd>
                                <p><b>{{ hand.grouper }}</b></p>
                            </dd>               
                        </dl>
                    </div>
                </div>
                {% else %}
                        <div class='span2 panel image' style='margin-left:12px;padding-left:0;padding-top:0;margin-top:0;margin-bottom:0;padding-bottom:0;'>
                            <dl class="imageDatabase">
                                <dt>
                                {% for graph in hand.list %}
                                {% if forloop.counter < 10 %}
                                <a title={{ hand.grouper.id }} href="/digipal/page/{{ graph.annotation.page.id }}/?vector_id={{ graph.annotation.vector_id }}">{{ graph.annotation.thumbnail }}</a>
                                {% endif %}
                                {% endfor %}                           
                                </dt>
                                <dd>
                                    <p><b>{{ hand.grouper }}</b></p>
                                </dd>               
                            </dl>
                        </div>
                {% endif %}
            {% endfor %}
            </div>
            {% paginate %}
    {% else %}
        <div class='alert alert-warning'>
            <h3>No Images available</h3>
        </div>
    {% endif %}
    </div>
        {% if view == 'List' %}
        <div class="tab-pane fade active in" id="list">
            {% else %}     
                <div class="tab-pane fade" id="list">
            {% endif %}
            {% regroup graphs by hand as handlist %}
            <table class="table table-condensed">
                <tr>
                    <th>Graphs</th>
                    <th>Hand</th>
                    <th>Scribe</th>
                    <th>Place</th>
                    <th>Date</th>
                    <th>Repository</th>
                    <th>Shelfmark</th>
                    <th>Catalogue Number</th>
                </tr>
                {% autopaginate handlist 18 %}
                {% for hand in handlist %}
                <tr class="{% cycle 'bgColour' '' %}">
                    <td>
                        {% for graph in hand.list %}
                        <a title={{ hand.grouper.id }} href="/digipal/page/{{ graph.annotation.page.id }}/?vector_id={{ graph.annotation.vector_id }}">{{ graph.annotation.thumbnail }}</a>
                        {% endfor %}
                    </td>
                    <td>{{ hand.grouper }}</td>
                    <td>{{ hand.grouper.scribe }}</td>
                    <td>{{ hand.grouper.assigned_place }}</td>
                    <td>{{ hand.grouper.assigned_date }}</td>
                    <td>{{ hand.grouper.item_part.current_item.repository.name }}</td>
                    <td>{{ hand.grouper.item_part.current_item.shelfmark }}</td>
                    <td>{{ hand.grouper.item_part.historical_item.catalogue_number }}</td>
                </tr>
                {% empty %} <td>No records to display.<td>
                {% endfor %}
                {% paginate %}
            </tbody>
            </table>
        </div>
    </div>
 
        <!--SCARTO DUE -->



{% endifequal %}

        </div>
    </div>
<script>
$(document).ready(function(){
 $('select').chosen();
});
</script>
<script>
  function setCookie(c_name,value,exdays){
    var exdate=new Date();
    exdate.setDate(exdate.getDate() + exdays);
    var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
    document.cookie=c_name + "=" + c_value;}

$('#myTab a').click(function (e) {
  e.preventDefault();
  $(this).tab('show');
  setCookie('view', this.innerHTML, '-1');
});

$('[data-toggle="tooltip"]').tooltip();

</script>
<script>
    $('#formFilters').show();
    $('#filterImages').text('Hide Filters Manuscripts');
    $('#filterImages').attr('class', 'btn');
    show_filters = 1;
</script>
{% endblock %}
