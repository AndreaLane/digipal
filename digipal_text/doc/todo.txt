! text not shown on opera: http://localhost/digipal/manuscripts/553/texts/view/#text-viewer
! V-scrollbar appears next to the image

Set up live server for MOA
MOA 66 - CT visibility
     DP:    - Text
     MOFA:  - Scribe, Hand, Graph
     EXON:  - IP, Scribe, Graph
     
     Affects:
        [DONE] Faceted
        [DONE] Adv. Search
        [DONE] Browser
        Record vis
            [DONT] IP
            [DONE]  Tabs
            [DONE] Images
            [DONE]  Tabs
            [DONE] Text
            [DONE] Scribe
            [DONE]  Tabs
            [DONE] Hand
            [DONE]  Tabs
            Graph on the Image annotator page
            [DONE]  Tabs

Review Faceted search customisations
    MOA
    Exon

[DONE] 1. find structure in form
[DONE] 2. map structure to DP data model
    Hand
    HandDescription
        +Label
        Description
    Stint?
[DONE] 3. modify DP data model
    + HandDescription.label
[DONE] 3.1 Add tinymce to admin
[DONE] 3.2 Paste text from word and remove all elements
4. mark-up text
    [DONE] Formatting & Structure
        [DONE] H1/H2/H3
    + improve the H1
        [DONE] auto mark-up with button
        () render as h4
        () generate the number automatically
    Fields
        () Idiosyncrasies
        [DONE] Stints
        ! prevent double markup
    Soft References
        [DONE] Scribe/Hand
    [DONE] Render char in italics and bold?
[DONE] 4.5. display links on front end
[DONE] 4.6. Assign images to hand based on the stints locations
[DONE] 5. locus: automatic detection
[DONE] 6. display description on front end
Search menu links to faceted search page 
[DONE] Convert characters to link to search page
Add missing detectable characters
7. Convert DigiPal & co data to the new format
    Data
        [LATER] Hand.ker/... -> HandDescription.Label
        !! Description:
            conversion script TEI -> new XML format
            make sure all the TEI elements are supported and have a button
    Forms (admin)
    Display


Scribe/Hand
    Project ID
        1
    EXON ID
        U-1
    Flight�s siglum
        alpha
    Locations
        Content (= General description of the locations)
            Found only in Wiltshire geld accounts.
            /
            Only Devon entries.
        Stints
            Flight
                175 (+1)
            || Stint
                Location: e.g. 29v14-16 (Q.6) or 263r1-4r20 (Q.54) or 37v3-19; 38r1-7 (Q.7)
                Note: Very similar to 'iota' + Identified by Webber (1989, p.12) as 'zeta'
    Main idiosyncrasies
        v-shaped cauda in e and q; -us suspension detached from letter on top of which is supposed to be; finishing strokes on baseline r and s. 
    Other relevant info
        Very few stints, but some are rather long. F found on margin next to beginning of each entry. Not exclusive to this scribe (quires 48-54)
        
        Probably author of unidentified stint on 61v18-20 [OF287v]
        /
        No use of round d; no use of et nota; frequent erasures, corrections and insertions
        /
        No use of ampersand; frequent erasures and corrections. Probably author of unidentified stint on 373r3-14 [OF11rv]
        
        5 full pages (20 lines each).
        
        Second part of line 13 and lines 14 and 15 are clearly the work of �eta�. The first (10) words may initially seem the work of a different hand, but after detailed analysis they seem to be by �eta�: overlines; e-cauda; ampersand; shapes of a, t; tail of g is uncommon, but occasionally found in �eta� (520r1 and 4, 522v12). Gallows mark by �mu� however.
    Identified?
    
    
    
        

        
        http://localhost/admin/digipal/hand/2/
        http://severedheads.bandcamp.com/album/cuisine-w-piscatorial

TODO

1. upload images
    . need to create ssh connection
    . port issue: 2222 -> 22 on b2d doesn't work, windows not listening to 2222
    . b2d listening for 2222
    => VB port mapping not working OR b2d blocking port.
    . same with 8081, used to work though
        . removing port from VB is effective immediately, but not when adding
        . port still not available after saving then starting machine or powering it down and restarting
        
2. convert images to compatible format
3. check manual upload format
4. pack up the VM & move it to the server
5. send instructions on how to download and use it

http://localhost/digipal/manuscripts/553/texts/view/#text-viewer
http://localhost/digipal/manuscripts/199/texts/view/

XML-HTML -> XML

    <span data-dpt="tag" data-dpt-attr1="val1">content</span>
    
    ->
    
    <tag attr1="val1">content</tag>

XML

    H<expan>enry</expan>
        () H<expan abbrev="">enry</expan>
        Different from TEI

BOTH

    invalid location or error
        reset the content of the panel, prevent edition


    Save the name of the last person to save the text
    Save the person in the backup as well 

    Pipes
        auto-markup: convert them into span
        key press: convert them into span
        display spans as pipe (content)
            as line break as well (toggle it on/off)


    () . read only mode 

    () Image Panel
        zoom inset on click 
            OR zoomify
        !!Bypass image size quota:
            Zoomify?
            Open Layer?
        
    () Addressability
        Expose and resolve URL leading directly to translation or transcription
    
MOFA

EXON Progress

    Points for the meeting
        Manual Review of the mark-up and segmentation
            Easy export of the XML for review
            Export of the entry numbers

EXON
    
    1. folio numbers
        load/save folio text
        sync with images
        drop down to say if we want to sync of not
    [DONE] 2. save changes
    3. pg down, ...
    4. show snippets on search results


    !!!
        enforce structure:
            flat structure: p and no divs
            p at the top level
            locations within ps
    
    If select 520, show 520, 520a1, ...
        e.g. 210a exists but 170a not
    
    Bug with segmentation
        4 hides under 14a1 is interpreted as an entry number
        Search for 4 

    [DONE] Upload text
    
    Improve the loading of the locations:
        request and refresh the locations each time the location type is changed
    
    customise 
        the buttons
        the conversion of the notations (), [] etc.
            [DONE] <p style="margin-bottom: 0cm;">&nbsp;</p>
            [DONE] <span style="text-decoration: line-through;">of these</span> 

    Split long texts into small parts
        [DONE] mark up scheme
            entry
            folio
            section
        [DONE] splitting by entry
        [DONE] pull locations from database
        [DONE] display one piece
        [DONE] location change
    
    Mark up
        entry
        folio
            automate the sequence update in case of change
          
    Sync images and text
    
    Search
        show hits
        go to specific location
        
    () Attach information to an entry
        people
        places
        etc.

    ? mark-up records
        person
        place
        Q: should we use an intermediary record to represent any type of entity? There are some commonalities among rec types such as normalised name, name before and after conquest, etc. 
        Or do we link directly to a Person/Place record?
        Q: what about the distinction between identified entity and occurrence of an entity name?

PUBLIC VIEW

    ***** DON'T SHOW THE FULL SIZE VERSION OF THE IMAGE!
    Switch edit/view

BUGS
    
    Make sure we can't save the content before it is loaded
    What if you edit the same text in different panels?
    Fix the slug in the admin:
        the slug should be read only
        for the moment we always update the slug automatically on save
    TinyMCE will not work well (setContent and editing mode fails) when the panel is collapse at the time of the loading

    
Presentation
    resizing a panel doesn't work smoothly when the mouse goes over TinyMCE
    Fix the panelset being a few pixels too tall
    Layout switches
    Put the digipal style sheets back
        put them back
        fix the banner/nav
    [DONE] relative size of the panels. e.g. 50% split centre and south
    Improve the layout so if the set ratios are preserved even when resizing the browser window
    (Re)design:
        decide if the layout is completely managed by the viewer
        would be nice if west is on the left of south: that would require to nest one layout inside another
    BUG: when you close the south pane the iframe managed by the nested tinymce will loose the content of its head and body.

Improvements
    Panel asks for location list and types. Populate and show controls accordingly (e.g. Text may not want to display it at this stage, Image only shows locations not types).
    Status messages should come from the server?
    auto-save before large operations

    saving
        saving bugs
            requirements:
                don't count loading as a modification of the text
                don't save too many times
                save all changes
            
            method:
                use on change event on tinmyce
                    => not triggered until the cursor is moved out of the current line
                        e.g. append chars at the end of a line => nothing, move cursor up => triggered
                        => we may miss changes if the user closes the tab after writing
                compare the size of the content every x seconds
                    => it won't catch modifications which preserve the same length
                    => not the most efficient as we have to get the content each time that's extra processing
                use both
                    => save is triggered twice
            
        regular saving
            avoid simultaneous savings
            avoid too frequent savings
            
        [DONE] backup button
            add a new table: TextContentXMLBackup
            add a button to save to this table
            
    
Performance
    The full Exon translation (experiment with FireFox):
        can be added with tinymce, pasted from Word it will strip almost all styles and keep minimal HTML
        pasting takes a long time (~20s) but it is decent given the size of the text however it freezes the browser and we can get javascript performance warnings
        the size is 310KB
        loading the text takes just 150ms but setting it into TinyMCE make the browser freeze for a few seconds 
        sending the text and saving it to the DB takes less than 1 seconds however the browser tends to freeze and be very laggy after a few operations

Maybe
    Image Panel
        layout selection (width fit, height fit, best fit)
    ? show address selector
    Let panels from different browser tabs communicate
        synchronise position
        edition + refresh views, etc.
    Name tables in the admin: in the future we may want to 
        make the slug input writable
        keep the slug as it is even when the name changes 
        but if the slug is blanked (or add an icon for that) we reset it.
    Generalise API:
        query for the list of locations and this can be handled by the custom function on server side
    Show status bar at the bottom of each panel:
        duration of the request
        icon to show the message in full

DONE

    [DONE] Show status bar at the bottom of each panel:
        [DONE] html
        [DONE] CSS
        [DONE] dynamic resize
        [DONE] function to show message
        [DONE] show message
        [DONE] time of the message
        [DONE] truncate the message to make it fit in the available space
    [DONE] WriteTextView
    [DONE] show tinymce
    [DONE] Junicode
    [DONE] Basic TextWrite:
        read text from database (create if not there)
        display it
    [DONE] show only one panel with transcription
    [DONE] auto-save
    
    [DONE] 1. ** Dynamically create the views based on the content types
        [DONE] generic constructor of a panel
        [DONE] update content type drop down
        [DONE] react to changes in the drop down
        [DONE] load the transcription or translation
    [DONE] Basic Image panel
        [DONE] load image
        [DONE] fit to width
        [DONE] scroll only the content
        [DONE] load locations
        [DONE] change location
        
    [DONE] fix undo/redo!
    
    [DONE] Keep surrounding spaces out of some of the markup (e.g. expansion)

    [DONE] conversion of the format to html
        ()
        italics
        |
        <>
        and back
        Tironian mark

    [DONE] mark-up
        [DONE] expansion
            [DONE]add button & mark up selection
            [DONE] icon
        [DONE] supplied
        [DONE] deletion
        [DONE] clauses
            drop-down
        [DONE] clear
        
        [DONE] show the mark up
            basic styling
    [DONE] Document the editor in Confluence

    
[a]
(Char, Char, Char)
[(Bool, Char)]
([a], [a])

