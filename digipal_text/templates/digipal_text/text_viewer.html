{% extends "base.html" %}
{% load html_escape %}

{% block meta_title %}{{ item_part.display_label }}: Texts{% endblock %}

{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" href="{{ STATIC_URL }}digipal_text/junicode/junicode.css"/>
    {% comment %}
        Trick: TinyMCE will load this later dynamically
        but that happens AFTER our resize calculate the height of the button bar
        which is unstyled yet and therefore too tall and shrinks the iframe.
        The solution is to force a load of the stylesheet here so the computation
        is accurate.
    {% endcomment %}
    <link rel="stylesheet" href="{{ STATIC_URL }}digipal_text/tinymce/skins/digipal/skin.min.css"/>
    <link rel="stylesheet" href="{{ STATIC_URL }}digipal_text/viewer/viewer.css"/>
    {# We need this for the readonly version although tinymce may also load it a second time for its iframe #}
    <link rel="stylesheet" href="{{ STATIC_URL }}digipal_text/viewer/tinymce.css?v={% now "U:u" %}"/>
    <link rel="stylesheet" href="{{ STATIC_URL }}digipal/bs-dd-cb/bootstrap-dropdown-checkbox.css"/>
    <link rel="stylesheet" href="{{ STATIC_URL }}digipal/openlayers3/ol.css"/>
{% endblock %}

{% block main %}

<h1><a href="{{ item_part.get_absolute_url }}">{{ item_part.display_label }}</a>: Texts</h1>

{# Template for the frame #}
<div id="text-viewer">
    <div class="message-box">
        <a href="#text-viewer" style="float:left;" title="Expand" data-toggle="tooltip" data-placement="bottom"><span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span></a>
        <span class="message-content">&nbsp;</span>
    </div>
    <div class="panels">
        <div class="ui-layout-north">North</div>
        {# <div class="ui-layout-west">Navigator</div> #}
        <div class="ui-layout-center">Text</div>
        <div class="ui-layout-east">East</div>
        {# <div class="ui-layout-south">Images</div> #}
    </div>
</div>

{# Template for a panel within the frame #}
<div id="text-viewer-panel" class="text-viewer-panel">
    <div class="btn-toolbar">
        <div class="btn-group dropdown-content-type">
            {% include "bootstrap/dropdown.html" with options=dd_content_types classes="auto-open" %}
        </div>

        <div class="btn-group">
            {% include "bootstrap/dropdown.html" with options=dd_location_types classes="dropdown-location-type dphidden auto-open" %}
        </div>
        <div class="btn-group dphidden">
            <select name="location" class="can-add">
                <option value="1r">1r</option>
                <option value="1v">1v</option>
            </select>
        </div>
        
        <div class="btn-group dphidden">
            <div class="presentation-options"></div>
        </div>
        
        {% if request.user.is_authenticated %}
            <div class="btn-group">
                <button class="btn btn-default btn-sm toggle-edit dphidden" title="Edit the text" data-toggle="tooltip" href="#toggle-edit" data-placement="bottom">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                </button>
                {% if statuses.count > 1 %}
                    <span class="dphidden">
                        <select name="status" class="no-search">
                            {% for status in statuses %}
                                <option value="{{ status.id }}">{{ status.name }}</option>
                            {% endfor %}
                        </select>
                    </span>
                {% endif %}
            </div>
        {% endif %}
        
    </div>
    
    <div class="panel-content">
    </div>
    
    <div class="status-bar">
        <span class="status"></span>
        <span class="message"></span>
        <span class="time pull-right"></span>
    </div>
    
</div>

{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <script src="{{ STATIC_URL }}digipal_text/jqlayout/jquery.layout.min.js"></script>
    {# TODO: include min on production #}
    <script src="{{ STATIC_URL }}digipal_text/tinymce/tinymce.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}digipal/scripts/dpbootstrap.js"></script>
    <script src="{{ STATIC_URL }}digipal_text/viewer/panelset.tinymce.js"></script>
    {# <script src="{{ STATIC_URL }}digipal_text/viewer/panelset.js?v={% now "U:u" %}"></script> #}
    <script src="{{ STATIC_URL }}digipal_text/viewer/panelset.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/chosen.jquery.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}digipal/openlayers3/ol.js"></script>
    <script src="{{ STATIC_URL }}digipal/bs-dd-cb/bootstrap-dropdown-checkbox.min.js"></script>
    <script>
        jQuery(document).ready(function($) {
            var panelset = new TextViewer.PanelSet($('#text-viewer'));
            panelset.setItemPartid('{{ item_partid }}');
            panelset.setLayout($('#text-viewer .panels'));
            panelset.setMessageBox($('#text-viewer .message-box'));
            panelset.setExpandButton($('#text-viewer .message-box a'));
            
            panelset.registerPanel(TextViewer.Panel.create('image', '.ui-layout-north'));
            panelset.registerPanel(TextViewer.Panel.create('transcription', '.ui-layout-center'));
            //panelset.registerPanel(TextViewer.Panel.create('translation', '.ui-layout-center', true));
            panelset.registerPanel(TextViewer.Panel.create('translation', '.ui-layout-east'));
            //panelset.registerPanel(TextViewer.Panel.create('xmlelement', '.ui-layout-west', true));
            //panelset.registerPanel(TextViewer.Panel.create('image', '.ui-layout-south'));
            //panelset.setPanelSize('west', 0.5);
            panelset.ready();
            //panelset.setPanelSize('south', 0);
            panelset.setPanelSize('north', 0.4);
            panelset.setPanelSize('east', 0.5);
            //panelset.setPanelSize('center', 0);
            //panelset.setPanelSize('west', 0);
            //panelset.setPanelSize('south', 0);
        });
    </script>
{% endblock %}
